<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:pfx="http://www.tibco.com/schemas/MobCastleAD1006RemoteReport_JSON/FrontJSONUI/Level1/Schema.xsd" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:pfx2="http://www.tibco.com/ns/no_namespace_schema_location/FrontJSONUI/Level2/CSVFormat.sharedparse" xmlns:ns="http://www.tibco.com/pe/EngineTypes" xmlns:ns12="http://www.tibco.com/namespaces/tnt/plugins/json" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:ns2="http://www.tibco.com/pe/DeployedVarsType" xmlns:ns1="http://www.tibco.com/namespaces/tnt/plugins/file/v2" xmlns:ns3="http://www.tibco.com/namespaces/tnt/plugins/file">
    <xsd:import namespace="http://www.tibco.com/schemas/MobCastleAD1006RemoteReport_JSON/FrontJSONUI/Level1/Schema.xsd" schemaLocation="/FrontJSONUI/Level1/AllJSONSchema.xsd"/>
    <xsd:import namespace="http://www.tibco.com/ns/no_namespace_schema_location/FrontJSONUI/Level2/CSVFormat.sharedparse" schemaLocation="/FrontJSONUI/Level2/CSVFormat.sharedparse"/>
    <pd:name>FrontJSONUI/Level2/report.process</pd:name>
    <pd:startName>Start</pd:startName>
    <pd:startType ref="pfx:AllJSONRequests"/>
    <pd:startX>80</pd:startX>
    <pd:startY>64</pd:startY>
    <pd:returnBindings>
        <pfx:SubEnd>
            <pfx:JSONResponse>
                <xsl:value-of select="concat($FormatReportResponse/root/formatReport, $JSON_AllResponse/ns12:ActivityOutputClass/jsonString)"/>
            </pfx:JSONResponse>
        </pfx:SubEnd>
    </pd:returnBindings>
    <pd:endName>End</pd:endName>
    <pd:endType ref="pfx:SubEnd"/>
    <pd:endX>487</pd:endX>
    <pd:endY>146</pd:endY>
    <pd:errorSchemas/>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1478154485942</pd:targetNamespace>
    <pd:activity name="offer_query">
        <pd:type>com.tibco.plugin.jdbc.JDBCGeneralActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCGeneralActivity</pd:resourceType>
        <pd:description>concat("select ",$e/tableName,"_id,",$e/tableName,"_name,",$e/tableName,"_status from ",$e/tableName," where ",$e/tableName,"_id like '%",$SearchAllTables/ProcessStarterOutput/parameters/searchValue,"%' or ",$e/tableName,"_name like '%",$SearchAllTables/ProcessStarterOutput/parameters/searchValue,"%'")</pd:description>
        <pd:x>81</pd:x>
        <pd:y>196</pd:y>
        <config>
            <timeout>10</timeout>
            <commit>false</commit>
            <maxRows>5000</maxRows>
            <jdbcSharedConfig>/0920UpdateTables/MySql.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcGeneralActivityInput>
                <statement>
                    <xsl:value-of select="concat(&#xA;&quot;select * from view_label_offer_status_notpause &quot;,&#xA;&quot;where offer_id like '%&quot;,&#xA;$Start/pfx:AllJSONRequests/pfx:offerreportsearch,&#xA;&quot;%' or offer_name like '%&quot;,&#xA;$Start/pfx:AllJSONRequests/pfx:offerreportsearch,&#xA;&quot;%'&quot;,&#xA;&quot; order by offer_id desc&quot;&#xA;)"/>
                </statement>
            </jdbcGeneralActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="n_query">
        <pd:type>com.tibco.plugin.jdbc.JDBCGeneralActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCGeneralActivity</pd:resourceType>
        <pd:x>78</pd:x>
        <pd:y>324</pd:y>
        <config>
            <timeout>10</timeout>
            <commit>false</commit>
            <maxRows>5000</maxRows>
            <jdbcSharedConfig>/0920UpdateTables/MySql.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcGeneralActivityInput>
                <statement>
                    <xsl:value-of select="concat(&quot;select * from view_label_n_status_notpause where n_id like '%&quot;,&#xA;$Start/pfx:AllJSONRequests/pfx:nreportsearch,&#xA;&quot;%' or n_name like '%&quot;,&#xA;$Start/pfx:AllJSONRequests/pfx:nreportsearch,&#xA;&quot;%'&quot;,&#xA;&quot; order by n_id desc&quot;&#xA;)"/>
                </statement>
            </jdbcGeneralActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SaveConcat">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>179</pd:x>
        <pd:y>328</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="offer" type="xsd:string" minOccurs="0"/>
                            <xsd:element name="n" type="xsd:string" minOccurs="0"/>
                            <xsd:element name="startdate" type="xsd:string" minOccurs="0"/>
                            <xsd:element name="enddate" type="xsd:string" minOccurs="0"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <offer>
                    <xsl:value-of select="tib:concat-sequence-format(&#xA;for $row in $offer_query/jdbcGeneralActivityOutput/unknownResultset/row return $row/column[1]/value, &quot;','&quot;)"/>
                </offer>
                <n>
                    <xsl:value-of select="tib:concat-sequence-format(&#xA;for $row in $n_query/jdbcGeneralActivityOutput/unknownResultset/row return$row/column[1]/value, &quot;','&quot;)"/>
                </n>
                <xsl:choose>
                    <xsl:when test="$Start/pfx:AllJSONRequests/pfx:startdate!=&quot;&quot;">
                        <xsl:if test="$Start/pfx:AllJSONRequests/pfx:startdate">
                            <startdate>
                                <xsl:value-of select="$Start/pfx:AllJSONRequests/pfx:startdate"/>
                            </startdate>
                        </xsl:if>
                    </xsl:when>
                    <xsl:otherwise>
                        <startdate>
                            <xsl:value-of select="substring-before(current-date(), &quot;+&quot;)"/>
                        </startdate>
                    </xsl:otherwise>
                </xsl:choose>
                <xsl:choose xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
                    <xsl:when test="$Start/pfx:AllJSONRequests/pfx:enddate=&quot;&quot;">
                        <enddate>
                            <xsl:value-of select="substring-before(current-date(), &quot;+&quot;)"/>
                        </enddate>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:if test="$Start/pfx:AllJSONRequests/pfx:enddate">
                            <enddate>
                                <xsl:value-of select="$Start/pfx:AllJSONRequests/pfx:enddate"/>
                            </enddate>
                        </xsl:if>
                    </xsl:otherwise>
                </xsl:choose>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="External Command">
        <pd:type>com.tibco.plugin.cmdexec.CmdExecActivity</pd:type>
        <pd:resourceType>ae.activities.CmdExecActivity</pd:resourceType>
        <pd:x>327</pd:x>
        <pd:y>62</pd:y>
        <config>
            <outputToString>true</outputToString>
            <lineSplit>None</lineSplit>
        </config>
        <pd:inputBindings>
            <CmdInput>
                <command>
                    <xsl:value-of select="concat(&quot;python report_merge_new.py &quot;,&#xA;$SaveConcat/root/startdate,&#xA;&quot; &quot;,&#xA;$SaveConcat/root/enddate,&#xA;&quot; &quot;,&#xA;$Start/pfx:AllJSONRequests/pfx:accuracy,&#xA;&quot; &quot;,&#xA;$SaveConcat_OfferNPair/root/offernpair&#xA; )"/>
                </command>
                <workingDirectory>
                    <xsl:value-of select="$_globalVariables/ns2:GlobalVariables/JSONUI/pythonworkdir"/>
                </workingDirectory>
            </CmdInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Read File">
        <pd:type>com.tibco.plugin.file.FileReadActivity</pd:type>
        <pd:resourceType>ae.activities.FileReadActivity</pd:resourceType>
        <pd:description>the csv is not utf-8 encoded</pd:description>
        <pd:x>259</pd:x>
        <pd:y>188</pd:y>
        <config>
            <encoding>text</encoding>
            <excludeContent>false</excludeContent>
        </config>
        <pd:inputBindings>
            <ns1:ReadActivityInputClass>
                <fileName>
                    <xsl:value-of select="concat(&#xA;$_globalVariables/ns2:GlobalVariables/JSONUI/pythonworkdir,&#xA;&quot;report_&quot;,&#xA;$_processContext/ns:ProcessContext/ProcessId,&#xA;&quot;.csv&quot;)"/>
                </fileName>
                <encoding>
                    <xsl:value-of select="&quot;CP936&quot;"/>
                </encoding>
            </ns1:ReadActivityInputClass>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="FormatReportResponse">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>675</pd:x>
        <pd:y>56</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="formatReport" type="xsd:string" minOccurs="0"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <formatReport>
                    <xsl:value-of select="concat(&#xA;$ReportCSS/ns3:ReadActivityOutputTextClass/fileContent/textContent,&#xA;&quot;&lt;tr>&lt;td>&quot;,&#xA;tib:substring-before-last($Java-Code/javaCodeActivityOutput/out, &quot;&lt;tr>&quot;), &#xA;&quot;&lt;/table>&quot;,&#xA;$DownloadReport/ns3:ReadActivityOutputTextClass/fileContent/textContent,&#xA;&quot;&lt;a href=http://60.205.189.32:9990/downloadreport?reportname=&quot;,&#xA;$Read-File/ns3:ReadActivityOutputTextClass/fileInfo/fullName,&#xA;&quot; name=report.csv>download Report Process&lt;/a> &lt;/body>&lt;/html>&quot;&#xA;)"/>
                </formatReport>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Java Code">
        <pd:type>com.tibco.plugin.java.JavaActivity</pd:type>
        <pd:resourceType>ae.javapalette.javaActivity</pd:resourceType>
        <pd:x>416</pd:x>
        <pd:y>185</pd:y>
        <config>
            <fileName>reportJavaCode</fileName>
            <packageName>FrontJSONUI.Level2.report</packageName>
            <fullsource>package FrontJSONUI.Level2.report;
import java.util.*;
import java.io.*;
public class reportJavaCode{
/****** START SET/GET METHOD, DO NOT MODIFY *****/
	protected String in = "";
	protected String out = "";
	public String getin() {
		return in;
	}
	public void setin(String val) {
		in = val;
	}
	public String getout() {
		return out;
	}
	public void setout(String val) {
		out = val;
	}
/****** END SET/GET METHOD, DO NOT MODIFY *****/
	public reportJavaCode() {
	}
	public void invoke() throws Exception {
/* Available Variables: DO NOT MODIFY
	In  : String in
	Out : String out
* Available Variables: DO NOT MODIFY *****/

out=in.replaceAll("\n","&lt;p&gt;");
out=out.replaceAll("&lt;p&gt;","&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;");
out=out.replaceAll(",","&lt;/td&gt;&lt;td&gt;");
}
}
</fullsource>
            <inputData>
                <row>
                    <fieldName>in</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
            </inputData>
            <outputData>
                <row>
                    <fieldName>out</fieldName>
                    <fieldType>string</fieldType>
                    <fieldRequired>optional</fieldRequired>
                </row>
            </outputData>
            <byteCode>
                <class>
                    <name>reportJavaCode</name>
                    <byteCode>yv66vgAAADQAMAkACwAfCQALACAKAAwAIQgAIggAIwgAJAoAJQAmCAAnCAAoCAApBwAqBwArAQACaW4BABJMamF2YS9sYW5nL1N0cmluZzsBAANvdXQBAAVnZXRpbgEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEABXNldGluAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAGZ2V0b3V0AQAGc2V0b3V0AQAGPGluaXQ+AQADKClWAQAGaW52b2tlAQAKRXhjZXB0aW9ucwcALAEAClNvdXJjZUZpbGUBABNyZXBvcnRKYXZhQ29kZS5qYXZhDAANAA4MAA8ADgwAGAAZAQAAAQABCgEAAzxwPgcALQwALgAvAQASPC90ZD48L3RyPjx0cj48dGQ+AQABLAEACTwvdGQ+PHRkPgEAKEZyb250SlNPTlVJL0xldmVsMi9yZXBvcnQvcmVwb3J0SmF2YUNvZGUBABBqYXZhL2xhbmcvT2JqZWN0AQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAEGphdmEvbGFuZy9TdHJpbmcBAApyZXBsYWNlQWxsAQA4KExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsAIQALAAwAAAACAAQADQAOAAAABAAPAA4AAAAGAAEAEAARAAEAEgAAAB0AAQABAAAABSq0AAGwAAAAAQATAAAABgABAAAACQABABQAFQABABIAAAAiAAIAAgAAAAYqK7UAAbEAAAABABMAAAAKAAIAAAAMAAUADQABABYAEQABABIAAAAdAAEAAQAAAAUqtAACsAAAAAEAEwAAAAYAAQAAAA8AAQAXABUAAQASAAAAIgACAAIAAAAGKiu1AAKxAAAAAQATAAAACgACAAAAEgAFABMAAQAYABkAAQASAAAANQACAAEAAAARKrcAAyoSBLUAASoSBLUAArEAAAABABMAAAASAAQAAAAVAAQABgAKAAcAEAAWAAEAGgAZAAIAEgAAAFIABAABAAAALioqtAABEgUSBrYAB7UAAioqtAACEgYSCLYAB7UAAioqtAACEgkSCrYAB7UAArEAAAABABMAAAASAAQAAAAdAA8AHgAeAB8ALQAgABsAAAAEAAEAHAABAB0AAAACAB4=</byteCode>
                </class>
            </byteCode>
        </config>
        <pd:inputBindings>
            <javaCodeActivityInput>
                <in>
                    <xsl:value-of select="$Read-File/ns3:ReadActivityOutputTextClass/fileContent/textContent"/>
                </in>
            </javaCodeActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="ReportCSS">
        <pd:type>com.tibco.plugin.file.FileReadActivity</pd:type>
        <pd:resourceType>ae.activities.FileReadActivity</pd:resourceType>
        <pd:x>416</pd:x>
        <pd:y>54</pd:y>
        <config>
            <encoding>text</encoding>
        </config>
        <pd:inputBindings>
            <ns1:ReadActivityInputClass>
                <fileName>
                    <xsl:value-of select="concat($_globalVariables/ns2:GlobalVariables/ProjectGV/ProjectFolder,&quot;\BakHTML\ReportTableCSS.txt&quot;)"/>
                </fileName>
                <encoding>
                    <xsl:value-of select="&quot;UTF-8&quot;"/>
                </encoding>
            </ns1:ReadActivityInputClass>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="DownloadReport">
        <pd:type>com.tibco.plugin.file.FileReadActivity</pd:type>
        <pd:resourceType>ae.activities.FileReadActivity</pd:resourceType>
        <pd:x>535</pd:x>
        <pd:y>53</pd:y>
        <config>
            <encoding>text</encoding>
        </config>
        <pd:inputBindings>
            <ns1:ReadActivityInputClass>
                <fileName>
                    <xsl:value-of select="concat($_globalVariables/ns2:GlobalVariables/ProjectGV/ProjectFolder,&quot;\BakHTML\TestSaveHTMLByJS.html&quot;)"/>
                </fileName>
                <encoding>
                    <xsl:value-of select="&quot;UTF-8&quot;"/>
                </encoding>
            </ns1:ReadActivityInputClass>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="ParseCSVData">
        <pd:type>com.tibco.plugin.parse.ParseActivity</pd:type>
        <pd:resourceType>ae.activities.ParseActivity</pd:resourceType>
        <pd:x>332</pd:x>
        <pd:y>315</pd:y>
        <config>
            <InputType>String</InputType>
            <Encoding>ASCII</Encoding>
            <ParseSharedConfig>/FrontJSONUI/Level2/CSVFormat.sharedparse</ParseSharedConfig>
            <SkipBlankLines>true</SkipBlankLines>
            <SpecifyStartRecord>false</SpecifyStartRecord>
        </config>
        <pd:inputBindings>
            <Input>
                <text>
                    <xsl:value-of select="$External-Command/CmdOutputWithActivityOutput/output[1]"/>
                </text>
                <noOfRecords>
                    <xsl:value-of select="10000"/>
                </noOfRecords>
            </Input>
        </pd:inputBindings>
    </pd:activity>
    <pd:group name="Group">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>435</pd:x>
        <pd:y>186</pd:y>
        <pd:width>348</pd:width>
        <pd:height>239</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>$ParseCSVData/Output/Rows/pfx:reportline_python</pd:over>
            <pd:iterationElementSlot>csvelement</pd:iterationElementSlot>
            <pd:indexSlot>csvindex</pd:indexSlot>
            <pd:outSlot>RepeatLinesResponse</pd:outSlot>
            <pd:activityOutputName>RepeatLines</pd:activityOutputName>
            <pd:accumulateOutput>true</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>GetOfferId_NId</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>GenerateCSVFile</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>GetOfferId_NId</pd:from>
            <pd:to>ExtendType</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>ExtendType</pd:from>
            <pd:to>EarningType</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>EarningType</pd:from>
            <pd:to>ExtendType_EarningType_Repeat</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>ExtendType_EarningType_Repeat</pd:from>
            <pd:to>OfferNLable</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>RepeatLines</pd:from>
            <pd:to>GenerateCSVFile</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>OfferNLable</pd:from>
            <pd:to>RepeatLines</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:activity name="ExtendType">
            <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
            <pd:resourceType>ae.process.subprocess</pd:resourceType>
            <pd:x>497</pd:x>
            <pd:y>349</pd:y>
            <config>
                <processName>/FrontJSONUI/Level3/Common_Sql.process</processName>
            </config>
            <pd:inputBindings>
                <root>
                    <sql>
                        <xsl:value-of select="concat(&#xA;&quot;select campaign_expend_t,campaign_expend_c,campaign_expend_n,&quot;,&#xA;&quot;campaign_rm,campaign_id from campaign where offer_id=&quot;,&#xA;$csvelement/pfx:reportline_python/pfx:offer_query,&#xA;&quot; and n_id=&quot;,&#xA;$csvelement/pfx:reportline_python/pfx:n_query&#xA;)"/>
                    </sql>
                </root>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="EarningType">
            <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
            <pd:resourceType>ae.process.subprocess</pd:resourceType>
            <pd:x>545</pd:x>
            <pd:y>242</pd:y>
            <config>
                <processName>/FrontJSONUI/Level3/Common_Sql.process</processName>
            </config>
            <pd:inputBindings>
                <root>
                    <sql>
                        <xsl:value-of select="concat(&#xA;&quot;select offer_earning_t,offer_earning_c,offer_earning_n,&quot;,&#xA;&quot;offer_e_expend_t,offer_e_expend_c,offer_e_expend_n,&quot;,&#xA;&quot;offer_id from offer where offer_id=&quot;,&#xA;$csvelement/pfx:reportline_python/pfx:offer_query&#xA;)"/>
                    </sql>
                </root>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="GetOfferId_NId">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>488</pd:x>
            <pd:y>244</pd:y>
            <config>
                <element>
                    <xsd:element name="root">
                        <xsd:complexType>
                            <xsd:sequence>
                                <xsd:element name="repeatelements" minOccurs="0">
                                    <xsd:complexType>
                                        <xsd:sequence>
                                            <xsd:element name="offer_id" type="xsd:string" minOccurs="0"/>
                                            <xsd:element name="n_id" type="xsd:string" minOccurs="0"/>
                                        </xsd:sequence>
                                    </xsd:complexType>
                                </xsd:element>
                            </xsd:sequence>
                        </xsd:complexType>
                    </xsd:element>
                </element>
            </config>
            <pd:inputBindings>
                <root>
                    <repeatelements>
                        <offer_id>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:offer_query"/>
                        </offer_id>
                        <n_id>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:n_query"/>
                        </n_id>
                    </repeatelements>
                </root>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="ExtendType_EarningType_Repeat">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>581</pd:x>
            <pd:y>345</pd:y>
            <config>
                <element>
                    <xsd:element name="root">
                        <xsd:complexType>
                            <xsd:sequence>
                                <xsd:element name="extend_type" type="xsd:string" minOccurs="0"/>
                                <xsd:element name="earning_type" type="xsd:string" minOccurs="0"/>
                                <xsd:element name="out_price" type="xsd:string" minOccurs="0"/>
                                <xsd:element name="in_price" type="xsd:string" minOccurs="0"/>
                                <xsd:element name="offer_link" type="xsd:string" minOccurs="0"/>
                                <xsd:element name="n_link" type="xsd:string" minOccurs="0"/>
                            </xsd:sequence>
                        </xsd:complexType>
                    </xsd:element>
                </element>
            </config>
            <pd:inputBindings>
                <root>
                    <extend_type>
                        <xsl:value-of select="concat(&#xA;$ExtendType/unknownResultset[1]/row[1]/column[1]/value,&#xA;&quot;-&quot;,&#xA;$ExtendType/unknownResultset[1]/row[1]/column[2]/value&#xA;)"/>
                    </extend_type>
                    <earning_type>
                        <xsl:value-of select="concat(&#xA;$EarningType/unknownResultset[1]/row[1]/column[1]/value,&#xA;&quot;-&quot;,&#xA;$EarningType/unknownResultset[1]/row[1]/column[2]/value&#xA;)"/>
                    </earning_type>
                    <xsl:if test="$ExtendType/unknownResultset[1]/row[1]/column[3]/value">
                        <out_price>
                            <xsl:value-of select="$ExtendType/unknownResultset[1]/row[1]/column[3]/value"/>
                        </out_price>
                    </xsl:if>
                    <xsl:if test="$EarningType/unknownResultset[1]/row[1]/column[3]/value">
                        <in_price>
                            <xsl:value-of select="$EarningType/unknownResultset[1]/row[1]/column[3]/value"/>
                        </in_price>
                    </xsl:if>
                    <offer_link>
                        <xsl:value-of select="concat(&#xA;if ($_globalVariables/ns2:GlobalVariables/JSONUI/DomainName!=&quot;&quot;) then $_globalVariables/ns2:GlobalVariables/JSONUI/DomainName else &quot;http://91mobcastle.com&quot;,&#xA;&quot;/detail/&quot;,&#xA;&quot;offer&quot;,&#xA;&quot;-detail.html?id=&quot;,&#xA;$csvelement/pfx:reportline_python/pfx:offer_query&#xA;)"/>
                    </offer_link>
                    <n_link>
                        <xsl:value-of select="concat(&#xA;if ($_globalVariables/ns2:GlobalVariables/JSONUI/DomainName!=&quot;&quot;) then $_globalVariables/ns2:GlobalVariables/JSONUI/DomainName else &quot;http://91mobcastle.com&quot;,&#xA;&quot;/detail/&quot;,&#xA;&quot;n&quot;,&#xA;&quot;-detail.html?id=&quot;,&#xA;$csvelement/pfx:reportline_python/pfx:n_query&#xA;)"/>
                    </n_link>
                </root>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="RepeatLines">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>681</pd:x>
            <pd:y>348</pd:y>
            <config>
                <element ref="pfx:reportline"/>
            </config>
            <pd:inputBindings>
                <pfx:reportline>
                    <xsl:if test="$csvelement/pfx:reportline_python/pfx:time">
                        <pfx:time>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:time"/>
                        </pfx:time>
                    </xsl:if>
                    <pfx:offer_query>
                        <xsl:value-of select="$OfferNLable/root/offerlabel"/>
                    </pfx:offer_query>
                    <xsl:if test="$ExtendType_EarningType_Repeat/root/offer_link">
                        <pfx:offer_link>
                            <xsl:value-of select="$ExtendType_EarningType_Repeat/root/offer_link"/>
                        </pfx:offer_link>
                    </xsl:if>
                    <pfx:n_query>
                        <xsl:value-of select="$OfferNLable/root/nlabel"/>
                    </pfx:n_query>
                    <xsl:if test="$ExtendType_EarningType_Repeat/root/n_link">
                        <pfx:n_link>
                            <xsl:value-of select="$ExtendType_EarningType_Repeat/root/n_link"/>
                        </pfx:n_link>
                    </xsl:if>
                    <pfx:click>
                        <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:click"/>
                    </pfx:click>
                    <xsl:if test="$csvelement/pfx:reportline_python/pfx:normal">
                        <pfx:normal>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:normal"/>
                        </pfx:normal>
                    </xsl:if>
                    <pfx:conversionrate>
                        <xsl:value-of select="if ($csvelement/pfx:reportline_python/pfx:click&lt;&#xA;(&#xA;$csvelement/pfx:reportline_python/pfx:normal +&#xA;$csvelement/pfx:reportline_python/pfx:rm +&#xA;$csvelement/pfx:reportline_python/pfx:duplicated&#xA;)&#xA;) then &quot;100.0000%&quot; else &#xA;concat(&#xA;tib:round-fraction(((&#xA;($csvelement/pfx:reportline_python/pfx:normal+$csvelement/pfx:reportline_python/pfx:rm)&#xA;div&#xA;$csvelement/pfx:reportline_python/pfx:click&#xA;)*100)&#xA;,4),&#xA;&quot;%&quot;)"/>
                    </pfx:conversionrate>
                    <xsl:if test="$ExtendType_EarningType_Repeat/root/extend_type">
                        <pfx:campaign_expendtype>
                            <xsl:value-of select="$ExtendType_EarningType_Repeat/root/extend_type"/>
                        </pfx:campaign_expendtype>
                    </xsl:if>
                    <xsl:if test="$ExtendType_EarningType_Repeat/root/out_price">
                        <pfx:out_price>
                            <xsl:value-of select="$ExtendType_EarningType_Repeat/root/out_price"/>
                        </pfx:out_price>
                    </xsl:if>
                    <xsl:if test="$ExtendType_EarningType_Repeat/root/earning_type">
                        <pfx:offer_earningtype>
                            <xsl:value-of select="$ExtendType_EarningType_Repeat/root/earning_type"/>
                        </pfx:offer_earningtype>
                    </xsl:if>
                    <xsl:if test="$ExtendType_EarningType_Repeat/root/in_price">
                        <pfx:in_price>
                            <xsl:value-of select="$ExtendType_EarningType_Repeat/root/in_price"/>
                        </pfx:in_price>
                    </xsl:if>
                    <xsl:if test="$csvelement/pfx:reportline_python/pfx:rm">
                        <pfx:rm>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:rm"/>
                        </pfx:rm>
                    </xsl:if>
                    <xsl:if test="$csvelement/pfx:reportline_python/pfx:duplicated">
                        <pfx:duplicated>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:duplicated"/>
                        </pfx:duplicated>
                    </xsl:if>
                </pfx:reportline>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="GenerateCSVFile">
            <pd:type>com.tibco.plugin.file.FileWriteActivity</pd:type>
            <pd:resourceType>ae.activities.FileWriteActivity</pd:resourceType>
            <pd:x>688</pd:x>
            <pd:y>242</pd:y>
            <config>
                <encoding>text</encoding>
                <compressFile>None</compressFile>
                <append>true</append>
                <createMissingDirectories>true</createMissingDirectories>
            </config>
            <pd:inputBindings>
                <ns3:WriteActivityInputTextClass>
                    <fileName>
                        <xsl:value-of select="concat(&#xA;$_globalVariables/ns2:GlobalVariables/JSONUI/pythonworkdir,&#xA;&quot;report_&quot;,&#xA;$_processContext/ns:ProcessContext/ProcessId,&#xA;&quot;.csv&quot;)"/>
                    </fileName>
                    <textContent>
                        <xsl:value-of select="concat(&#xA;tib:concat-sequence-format(&#xA;for $ele in $RepeatLines/pfx:reportline/* return(&#xA;if(contains(local-name($ele),&quot;_link&quot;)&#xA;)&#xA;then &#xA;&quot;&quot;&#xA;else&#xA;concat(&#xA;$ele,&#xA;&quot;,&quot;&#xA;)&#xA;), &#xA;&quot;&quot;&#xA;),&#xA;&quot;&#xA;&quot;&#xA;)"/>
                    </textContent>
                    <encoding>
                        <xsl:value-of select="&quot;CP936&quot;"/>
                    </encoding>
                </ns3:WriteActivityInputTextClass>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="OfferNLable">
            <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
            <pd:resourceType>ae.process.subprocess</pd:resourceType>
            <pd:x>613</pd:x>
            <pd:y>242</pd:y>
            <config>
                <processName>/FrontJSONUI/Level3/Common_GenOfferNLabel.process</processName>
            </config>
            <pd:inputBindings>
                <root>
                    <xsl:if test="$csvelement/pfx:reportline_python/pfx:offer_query">
                        <offerid>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:offer_query"/>
                        </offerid>
                    </xsl:if>
                    <xsl:if test="$csvelement/pfx:reportline_python/pfx:n_query">
                        <nid>
                            <xsl:value-of select="$csvelement/pfx:reportline_python/pfx:n_query"/>
                        </nid>
                    </xsl:if>
                </root>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:activity name="JSON_AllResponse">
        <pd:type>com.tibco.plugin.json.activities.JSONRenderActivity</pd:type>
        <pd:resourceType>ae.activities.JSONRenderActivity</pd:resourceType>
        <pd:x>759</pd:x>
        <pd:y>142</pd:y>
        <config>
            <SchemaType>xsdType</SchemaType>
            <BadgerfishCheck>false</BadgerfishCheck>
            <ActivityInputEditor>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="responsestatus" type="xsd:string" minOccurs="0"/>
                            <xsd:element name="reportlink" type="xsd:string" minOccurs="0"/>
                            <xsd:element ref="pfx:reportline" minOccurs="0" maxOccurs="unbounded"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </ActivityInputEditor>
        </config>
        <pd:inputBindings>
            <ns12:ActivityInputClass>
                <root>
                    <responsestatus>
                        <xsl:value-of select="&quot;success&quot;"/>
                    </responsestatus>
                    <reportlink>
                        <xsl:value-of select="concat($_globalVariables/ns2:GlobalVariables/JSONUI/downloadreportink,$GenerateCSVFile/ns3:WriteActivityOutputClass/fileInfo/fullName)"/>
                    </reportlink>
                    <xsl:copy-of select="$RepeatLinesResponse/AccumulatedOutput/pfx:reportline"/>
                </root>
            </ns12:ActivityInputClass>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="GetCampId">
        <pd:type>com.tibco.plugin.jdbc.JDBCGeneralActivity</pd:type>
        <pd:resourceType>ae.activities.JDBCGeneralActivity</pd:resourceType>
        <pd:x>180</pd:x>
        <pd:y>200</pd:y>
        <config>
            <timeout>10</timeout>
            <commit>false</commit>
            <maxRows>5000</maxRows>
            <jdbcSharedConfig>/0920UpdateTables/MySql.sharedjdbc</jdbcSharedConfig>
        </config>
        <pd:inputBindings>
            <jdbcGeneralActivityInput>
                <statement>
                    <xsl:value-of select="concat(&quot;select campaign_id,offer_id,n_id from campaign where offer_id in ('&quot;,&#xA;$SaveConcat/root/offer,&#xA;&quot;') and n_id in ('&quot;,&#xA;$SaveConcat/root/n,&#xA;&quot;')&quot;)"/>
                </statement>
            </jdbcGeneralActivityInput>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SaveConcat_OfferNPair">
        <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
        <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
        <pd:x>178</pd:x>
        <pd:y>62</pd:y>
        <config>
            <element>
                <xsd:element name="root">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="offernpair" type="xsd:string" minOccurs="0"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </element>
        </config>
        <pd:inputBindings>
            <root>
                <offernpair>
                    <xsl:value-of select="tib:concat-sequence-format(&#xA;for $row in $GetCampId/jdbcGeneralActivityOutput/unknownResultset/row return concat($row/column[2]/value,&quot;:&quot;,$row/column[3]/value),&#xA;&quot;,&quot;)"/>
                </offernpair>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="DelReortFile">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>628</pd:x>
        <pd:y>141</pd:y>
        <config>
            <spawn>true</spawn>
            <processName>/FrontJSONUI/Level3/Common_DeleteFile.process</processName>
        </config>
        <pd:inputBindings>
            <root>
                <fileToDelete>
                    <xsl:value-of select="$GenerateCSVFile/ns3:WriteActivityOutputClass/fileInfo/fullName"/>
                </fileToDelete>
                <fileWaitTime>
                    <xsl:value-of select="300000"/>
                </fileWaitTime>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="GenerateCSVFile_Header">
        <pd:type>com.tibco.plugin.file.FileWriteActivity</pd:type>
        <pd:resourceType>ae.activities.FileWriteActivity</pd:resourceType>
        <pd:x>339</pd:x>
        <pd:y>419</pd:y>
        <config>
            <encoding>text</encoding>
            <compressFile>None</compressFile>
            <append>true</append>
            <createMissingDirectories>true</createMissingDirectories>
        </config>
        <pd:inputBindings>
            <ns3:WriteActivityInputTextClass>
                <fileName>
                    <xsl:value-of select="concat(&#xA;$_globalVariables/ns2:GlobalVariables/JSONUI/pythonworkdir,&#xA;&quot;report_&quot;,&#xA;$_processContext/ns:ProcessContext/ProcessId,&#xA;&quot;.csv&quot;)"/>
                </fileName>
                <textContent>
                    <xsl:value-of select="concat(&#xA;&quot;time,offer_query,n_query,click,normal,cvr(rm+normal),Extend(Out)Type,Extend(Out)Price,Earning(In)Type,Earning(In)Price,rm,duplicated&quot;,&#xA;&quot;&#xA;&quot;&#xA;)"/>
                </textContent>
                <encoding>
                    <xsl:value-of select="&quot;CP936&quot;"/>
                </encoding>
            </ns3:WriteActivityInputTextClass>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Catch">
        <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
        <pd:resourceType>ae.activities.catch</pd:resourceType>
        <pd:x>147</pd:x>
        <pd:y>528</pd:y>
        <pd:handler>true</pd:handler>
        <config>
            <catchAll>true</catchAll>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="Rethrow">
        <pd:type>com.tibco.pe.core.RethrowActivity</pd:type>
        <pd:resourceType>ae.activities.rethrow</pd:resourceType>
        <pd:x>286</pd:x>
        <pd:y>527</pd:y>
        <config/>
        <pd:inputBindings/>
    </pd:activity>
    <pd:transition>
        <pd:from>Start</pd:from>
        <pd:to>offer_query</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>offer_query</pd:from>
        <pd:to>n_query</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>n_query</pd:from>
        <pd:to>SaveConcat</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>External Command</pd:from>
        <pd:to>Read File</pd:to>
        <pd:xpathDescription>ReadCSVFile</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>1=2</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>Read File</pd:from>
        <pd:to>Java Code</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>xpath</pd:conditionType>
        <pd:xpath>$Start/pfx:AllJSONRequests/pfx:searchvalue="htmlreport"</pd:xpath>
    </pd:transition>
    <pd:transition>
        <pd:from>Java Code</pd:from>
        <pd:to>ReportCSS</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>ReportCSS</pd:from>
        <pd:to>DownloadReport</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>DownloadReport</pd:from>
        <pd:to>FormatReportResponse</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>FormatReportResponse</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Read File</pd:from>
        <pd:to>ParseCSVData</pd:to>
        <pd:xpathDescription>UseFilename</pd:xpathDescription>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>ParseCSVData</pd:from>
        <pd:to>GenerateCSVFile_Header</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Group</pd:from>
        <pd:to>JSON_AllResponse</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>JSON_AllResponse</pd:from>
        <pd:to>DelReortFile</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SaveConcat</pd:from>
        <pd:to>GetCampId</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GetCampId</pd:from>
        <pd:to>SaveConcat_OfferNPair</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SaveConcat_OfferNPair</pd:from>
        <pd:to>External Command</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>External Command</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>error</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>External Command</pd:from>
        <pd:to>ParseCSVData</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>DelReortFile</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GenerateCSVFile_Header</pd:from>
        <pd:to>Group</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Catch</pd:from>
        <pd:to>Rethrow</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
</pd:ProcessDefinition>